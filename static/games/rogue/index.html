<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Rogue - WebAssembly</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Spectral:wght@400;500&family=JetBrains+Mono:wght@400;600&display=swap");
  </style>
  <style>
    :root {
      color-scheme: dark;
      --ink: #f5deb3;
      --ink-dim: #bebebe;
      --ember: #ffa500;
      --ember-soft: #ff0000;
      --panel: rgba(0, 0, 0, 0.82);
      --panel-strong: rgba(0, 0, 0, 0.92);
      --frame: rgba(255, 255, 0, 0.35);
      --glow: rgba(255, 0, 255, 0.35);
      --shadow: rgba(0, 0, 0, 0.6);
    }
    * {
      box-sizing: border-box;
    }
    html,
    body {
      margin: 0;
      height: 100%;
      overflow: hidden;
    }
    body {
      background:
        radial-gradient(900px 700px at 18% 12%, rgba(0, 0, 255, 0.18), transparent 70%),
        radial-gradient(700px 600px at 85% 10%, rgba(0, 255, 255, 0.16), transparent 65%),
        radial-gradient(500px 420px at 70% 80%, rgba(255, 0, 255, 0.14), transparent 70%),
        linear-gradient(140deg, #000000 0%, #0a0a0a 50%, #000000 100%);
      color: var(--ink);
      font-family: "Spectral", "Georgia", serif;
      display: flex;
      flex-direction: column;
      letter-spacing: 0.2px;
    }
    header {
      padding: 18px 28px 10px;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 24px;
    }
    header h1 {
      margin: 0;
      font-family: "Cinzel", "Trajan Pro", serif;
      font-weight: 700;
      font-size: clamp(1.5rem, 2.4vw, 2.2rem);
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--ink);
      text-shadow: 0 0 18px rgba(255, 165, 0, 0.25);
    }
    header .subtitle {
      font-size: 0.95rem;
      color: var(--ink-dim);
    }
    #main {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 50%) minmax(0, 50%);
      gap: 20px;
      padding: 12px 24px 22px;
      align-items: stretch;
      min-height: 0;
    }
    #game-column {
      display: grid;
      grid-template-rows: auto minmax(0, 1fr) auto;
      gap: 12px;
      min-height: 0;
    }
    #game-shell {
      background: var(--panel-strong);
      border: 1px solid var(--frame);
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 20px 60px var(--shadow), inset 0 0 0 1px rgba(255, 255, 0, 0.08);
      position: relative;
      min-height: 0;
    }
    #game-shell::after {
      content: "";
      position: absolute;
      inset: 6px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 0, 0.1);
      pointer-events: none;
    }
    #game-container {
      display: grid;
      place-items: center;
      min-height: 0;
    }
    canvas {
      border: 2px solid rgba(255, 255, 0, 0.55);
      background: #000;
      image-rendering: pixelated;
      width: auto;
      height: auto;
      max-width: none;
      max-height: none;
      box-shadow: 0 0 24px rgba(0, 0, 0, 0.5), 0 0 30px rgba(255, 165, 0, 0.15);
    }
    #focus-hint {
      font-size: 0.9rem;
      color: var(--ink-dim);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    #focus-hint span {
      color: var(--ember);
      font-weight: 600;
    }
    #info-column {
      display: grid;
      grid-template-rows: auto auto 1fr;
      gap: 14px;
      min-height: 0;
    }
    #info-column .panel {
      height: 100%;
    }
    .tabs {
      display: grid;
      grid-template-rows: auto 1fr;
      gap: 12px;
      height: 100%;
    }
    .tab-list {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
    }
    .tab-button {
      border: 1px solid rgba(255, 255, 0, 0.25);
      background: rgba(0, 0, 0, 0.45);
      color: var(--ink);
      font-family: "Cinzel", "Trajan Pro", serif;
      letter-spacing: 0.6px;
      text-transform: uppercase;
      font-size: 0.85rem;
      padding: 8px 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
    }
    .tab-button[aria-selected="true"] {
      border-color: rgba(255, 165, 0, 0.8);
      box-shadow: 0 0 14px rgba(255, 165, 0, 0.2);
      transform: translateY(-1px);
    }
    .tab-button:focus-visible {
      outline: 2px solid rgba(255, 165, 0, 0.8);
      outline-offset: 2px;
    }
    .tab-panels {
      position: relative;
      min-height: 0;
    }
    .tab-panel {
      display: none;
      animation: tabFade 0.2s ease;
    }
    .tab-panel[aria-hidden="false"] {
      display: block;
    }
    .tab-panel p + p {
      margin-top: 10px;
    }
    @keyframes tabFade {
      from {
        opacity: 0.7;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .panel {
      padding: 14px 16px;
      background: var(--panel);
      border: 1px solid rgba(255, 255, 0, 0.25);
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(6px);
    }
    .panel h2 {
      margin: 0 0 8px;
      font-family: "Cinzel", "Trajan Pro", serif;
      font-size: 1rem;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--ink);
    }
    .panel p {
      margin: 0;
      color: var(--ink-dim);
      line-height: 1.45;
    }
    #controls ul {
      margin: 0;
      padding-left: 18px;
      color: var(--ink-dim);
    }
    #controls li {
      margin-bottom: 6px;
    }
    .controls-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
      color: var(--ink-dim);
    }
    .controls-table th,
    .controls-table td {
      padding: 6px 8px;
      vertical-align: top;
      border-bottom: 1px solid rgba(255, 255, 0, 0.15);
    }
    .controls-table th {
      text-align: left;
      font-weight: 600;
      color: var(--ink);
      width: 42%;
      letter-spacing: 0.3px;
    }
    .controls-table code {
      font-family: "JetBrains Mono", "Menlo", monospace;
      font-size: 0.9em;
      color: var(--ink);
    }
    #status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85rem;
      color: var(--ink-dim);
    }
    #status-bar strong {
      color: var(--ember);
      letter-spacing: 0.5px;
    }
    a {
      color: #ffff00;
      text-decoration: none;
      border-bottom: 1px solid rgba(255, 255, 0, 0.35);
    }
    a:hover {
      color: #ffa500;
      border-color: rgba(255, 165, 0, 0.7);
    }
    @media (max-width: 1080px) {
      #main {
        grid-template-columns: 1fr;
        padding: 8px 16px 16px;
      }
      #info-column {
        grid-template-rows: auto auto auto;
      }
      .tab-list {
        grid-template-columns: 1fr;
      }
    }
    @media (max-width: 680px) {
      header {
        flex-direction: column;
        align-items: flex-start;
      }
      #status-bar {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Rogue</h1>
    <div class="subtitle">A hand-forged dungeon crawl in Rust + WebAssembly</div>
  </header>
  <div id="main">
    <div id="game-column">
      <div id="game-shell">
        <div id="game-container">
          <canvas id="canvas" width="640" height="480" tabindex="0"></canvas>
        </div>
      </div>
    </div>
    <div id="info-column">
      <div class="panel">
        <div class="tabs" role="tablist" aria-label="Rogue info tabs">
          <div class="tab-list">
            <button class="tab-button" type="button" role="tab" aria-selected="true" aria-controls="tab-story" id="tab-story-button" data-tab="tab-story">Story</button>
            <button class="tab-button" type="button" role="tab" aria-selected="false" aria-controls="tab-controls" id="tab-controls-button" data-tab="tab-controls">Controls</button>
            <button class="tab-button" type="button" role="tab" aria-selected="false" aria-controls="tab-about" id="tab-about-button" data-tab="tab-about">About</button>
          </div>
          <div class="tab-panels">
            <section class="tab-panel" role="tabpanel" id="tab-story" aria-labelledby="tab-story-button" aria-hidden="false">
              <h2>Story</h2>
              <p>
                Beneath the iron hills of Enterprisia, the caverns wait like a patient tide. You descend with a lantern
                of stubborn flame, hearing dripstone and distant chains, and you map each bend in the dark by memory and
                grit. The dungeon is never quite the same twice; its corridors migrate, its doors forget, and the air grows
                colder the deeper you go.
              </p>
              <p>
                Rogue follows a lone adventurer who trades daylight for relics and hard-won knowledge. Hunger, wounds, and
                fear are as real as steel. Monsters stalk by scent and sound, and the safest path is rarely the straight one.
                Choose your fights. Guard your supplies. When the stairs appear, decide whether you climb back to the surface
                or press downward in pursuit of what the caverns keep hidden.
              </p>
              <p>
                This is a story of patience as much as bravery. The walls remember your footsteps, but not your name. Leave
                the caverns richer than you entered, or leave nothing at all.
              </p>
            </section>
            <section class="tab-panel" role="tabpanel" id="tab-controls" aria-labelledby="tab-controls-button" aria-hidden="true">
              <h2>Controls</h2>
              <table class="controls-table">
                <tbody>
                  <tr>
                    <th>Move</th>
                    <td>Arrow keys (cardinal)</td>
                  </tr>
                  <tr>
                    <th>Move + Diagonal</th>
                    <td>Numpad 7 8 9 / 4 5 6 / 1 2 3</td>
                  </tr>
                  <tr>
                    <th>Vi Movement</th>
                    <td>H J K L (cardinal) + Y U B N (diagonal)</td>
                  </tr>
                  <tr>
                    <th>Wait</th>
                    <td>Space or Numpad 5</td>
                  </tr>
                  <tr>
                    <th>Pick Up</th>
                    <td>G (on an item)</td>
                  </tr>
                  <tr>
                    <th>Inventory</th>
                    <td>I (arrows to select, Enter to use/equip, Esc to cancel)</td>
                  </tr>
                  <tr>
                    <th>Drop</th>
                    <td>D</td>
                  </tr>
                  <tr>
                    <th>Unequip</th>
                    <td>R</td>
                  </tr>
                  <tr>
                    <th>Descend</th>
                    <td><code>.</code> on stairs</td>
                  </tr>
                  <tr>
                    <th>Save &amp; Exit</th>
                    <td>Esc</td>
                  </tr>
                </tbody>
              </table>
            </section>
            <section class="tab-panel" role="tabpanel" id="tab-about" aria-labelledby="tab-about-button" aria-hidden="true">
              <h2>About</h2>
              <p>
                Rogue is written in Rust using the <code>rltk</code> / <code>bracket-lib</code> terminal stack, with
                <code>specs</code> for ECS and <code>wasm-bindgen</code> for the WebAssembly bridge. Rendering is done
                in the browser via WebGL.
              </p>
              <p>
                The game follows the
                <a href="https://bfnightly.bracketproductions.com/" target="_blank" rel="noopener">Rust Roguelike Tutorial</a>.
                To explore the code, check the repository youâ€™re running this build from.
              </p>
            </section>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="./rogue.js"></script>
  <script>
    window.addEventListener("load", async () => {
      await wasm_bindgen("./rogue_bg.wasm");
      const canvas = document.getElementById("canvas");
      if (!canvas) return;
      // Make canvas focusable
      canvas.tabIndex = 0;
      canvas.focus({ preventScroll: true });
      // Clicking on canvas gives it focus
      canvas.addEventListener("mousedown", () => canvas.focus());
      // Clicking outside canvas removes focus
      document.addEventListener("mousedown", (e) => {
        if (e.target !== canvas && document.activeElement === canvas) {
          canvas.blur();
        }
      });

      const gameKeySet = new Set([
        "ArrowUp",
        "ArrowDown",
        "ArrowLeft",
        "ArrowRight",
        " ",
        "Escape",
        "g",
        "i",
        "d",
        "r",
        ".",
      ]);
      const gameNumpadCodes = new Set([
        "Numpad1",
        "Numpad2",
        "Numpad3",
        "Numpad4",
        "Numpad5",
        "Numpad6",
        "Numpad7",
        "Numpad8",
        "Numpad9",
      ]);

      function isGameKey(e) {
        const key = e.key || "";
        if (gameKeySet.has(key) || gameKeySet.has(key.toLowerCase())) return true;
        if (gameNumpadCodes.has(e.code)) return true;
        return false;
      }

      function isTypingTarget(target) {
        return target && (target.tagName === "INPUT" || target.tagName === "TEXTAREA");
      }

      window.addEventListener("keydown", (e) => {
        if (isTypingTarget(e.target)) return;
        if (e.key === "f" || e.key === "F") {
          canvas.focus({ preventScroll: true });
        }
        if (isGameKey(e)) {
          e.preventDefault();
        }
      });

      const tabButtons = Array.from(document.querySelectorAll(".tab-button"));
      const tabPanels = Array.from(document.querySelectorAll(".tab-panel"));
      tabButtons.forEach((button) => {
        button.addEventListener("click", () => {
          const targetId = button.getAttribute("data-tab");
          tabButtons.forEach((btn) => {
            const isActive = btn === button;
            btn.setAttribute("aria-selected", isActive ? "true" : "false");
          });
          tabPanels.forEach((panel) => {
            const isActive = panel.id === targetId;
            panel.setAttribute("aria-hidden", isActive ? "false" : "true");
          });
        });
      });
    });
  </script>
</body>
</html>
